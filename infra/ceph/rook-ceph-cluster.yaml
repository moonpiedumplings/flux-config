---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: rook-ceph-cluster
  namespace: rook-ceph
spec:
  chart:
    spec:
      chart: rook-ceph-cluster
      reconcileStrategy: ChartVersion
      version: "v1.16.2"
      sourceRef:
        kind: HelmRepository
        name: rook
  interval: 1m0s
  values:
    operatorNamespace: rook-ceph
    # toolbox:
    #   enabled: true 
    clusterName: ceph
    cephClusterSpec:
      dataDirHostPath: /var/lib/rook
      mgr:
        count: 1
        allowMultiplePerNode: true
        modules: 
          - name: rook
            enabled: true
      mon:
        count: 1
      monitoring:
        enabled: false
      priorityClassNames:
        all: system-node-critical
        mgr: system-cluster-critical
      disruptionManagement:
        managePodBudgets: true
      cephConfig:
        global:
          osd_pool_default_size: "1"
          mon_warn_on_pool_no_redundancy: "false"
          bdev_flock_retry: "20"
          bluefs_buffered_io: "false"
          mon_data_avail_warn: "10"
      storage:
        useAllNodes: true
        useAllDevices: true
        allowDeviceClassUpdate: true
        allowOsdCrushWeightUpdate: false
        storageClassDeviceSets:
        - name: set1
          count: 1
          portable: false
          resources:
            limits:
              memory: "4Gi"
            requests:
              cpu: "500m"
              memory: "4Gi"
          placement:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 100
                podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: "rook.io/cluster"
                      operator: In
                      values:
                        - cluster1
                  topologyKey: "topology.kubernetes.io/zone"
          volumeClaimTemplates:
          - metadata:
              name: data
            spec:
              resources:
                requests:
                  storage: 10Gi
              storageClassName: openebs-persistent-hostpath
              volumeMode: Block
              accessModes:
                - ReadWriteOnce
    